<?php

/**
 * Skeleton subclass for performing query and update operations on the 'parametro' table.
 *
 *
 *
 * This class was autogenerated by Propel 1.6.7 on:
 *
 * 01/11/22 01:11:37
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class ParametroPeer extends BaseParametroPeer {

    static public function is_imagen($ruta, $archivo) {
        $retorna = '';
        if (trim($archivo) <> "") {
            $array = explode(".", $archivo);
            $exestion = $array[count($array) - 1];
            $exestion = strtoupper($exestion);

            $retorna = '<button class="btn btn-sm btn-block" ><li class="fa fa-download"></li> </button>';
            if ($exestion == "BMP") {
                $retorna = ' <img src="' . $ruta . $archivo . '" width="90px" >';
            }
            if ($exestion == "GIF") {
                $retorna = ' <img src="' . $ruta . $archivo . '" width="90px" >';
            }
            if ($exestion == "JPG") {
                $retorna = ' <img src="' . $ruta . $archivo . '" width="90px" >';
            }
            if ($exestion == "TIF") {
                $retorna = ' <img src="' . $ruta . $archivo . '" width="90px" >';
            }
            if ($exestion == "PNG") {
                $retorna = ' <img src="' . $ruta . $archivo . '" width="90px" >';
            }
            if ($exestion == "JGEP") {
                $retorna = ' <img src="' . $ruta . $archivo . '" width="90px" >';
            }
            $retorna = '<a href="' . $ruta . $archivo . '" target="_blank" >' . $retorna . "</a>";
        }
        return $retorna;
    }

    static public function eliminaVenta($id) {
        $opera = VentaResumidaQuery::create()->findOneById($id);
        $partidaId = $opera->getPartidaNo();
        $ventaREsumidaDetalle = VentaResumidaLineaQuery::create()
                ->filterByVentaResumidaId($id)
                ->find();
        foreach ($ventaREsumidaDetalle as $registro) {
            $movimientoBanco = MovimientoBancoQuery::create()->findOneByVentaResumidaLineaId($registro->getId());
            if ($movimientoBanco) {
                $cuentaBanco = CuentaBancoQuery::create()
                        ->filterByMovimientoBancoId($movimientoBanco->getId())
                        ->find();
                if ($cuentaBanco) {
                    $cuentaBanco->delete();
                }
                $movimientoBanco->delete();
            }
        }
        if ($ventaREsumidaDetalle) {
            $ventaREsumidaDetalle->delete();
        }
        $partidaQ = PartidaDetalleQuery::create()
                ->filterByPartidaId($partidaId)
                ->find();
        if ($partidaQ) {
            $partidaQ->delete();
        }
        $partidaQ = PartidaQuery::create()->findOneById($partidaId);
        if ($partidaQ) {
            $partidaQ->delete();
        }
        $opera->delete();
    }

    static function eliminaventadia($fecha, $usuario, $tiendaId) {
        date_default_timezone_set("America/Guatemala");
        $ventaRe = VentaResumidaQuery::create()
                ->filterByFecha($fecha)
                ->filterByTiendaId($tiendaId)
                ->filterByUsuario($usuario)
                ->find();
        $can = 0;
        foreach ($ventaRe as $reg) {
            $can++;
            ParametroPeer::eliminaVenta($reg->getId());
        }
//        echo "cantidad ".$can;
//        echo "<pre>";
//        print_r($ventaRe);
//        echo "</pre>";
//        die();
    }

}
