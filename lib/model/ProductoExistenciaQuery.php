<?php



/**
 * Skeleton subclass for performing query and update operations on the 'producto_existencia' table.
 *
 *
 *
 * This class was autogenerated by Propel 1.6.7 on:
 *
 * 01/28/22 04:34:03
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class ProductoExistenciaQuery extends BaseProductoExistenciaQuery
{
    
 static public function Resta($productoId, $cantidad, $bodegaId) {
             $empresaId = sfContext::getInstance()->getUser()->getAttribute("usuario", null, 'empresa');
        $productoExi = ProductoExistenciaQuery::create()
                ->filterByTiendaId($bodegaId)
                ->filterByProductoId($productoId)
                ->findOne();
        $cantidadAnterior = $productoExi->getCantidad();
        $nuevaCantidad = $cantidadAnterior - $cantidad;
        $productoExi->setCantidad($nuevaCantidad);
        $productoExi->save();
    }


     static public function Actualiza($productoId, $cantidad, $bodegaId) {
         $empresaId = sfContext::getInstance()->getUser()->getAttribute("usuario", null, 'empresa');
        $productoExi = ProductoExistenciaQuery::create()
                ->filterByProductoId($productoId)
                ->filterByTiendaId($bodegaId)
                ->findOne();
        if (!$productoExi) {
            $productoExi = new ProductoExistencia();
            $productoExi->setEmpresaId($empresaId);
            $productoExi->setProductoId($productoId);
            $productoExi->setTiendaId($bodegaId);
            $productoExi->setCantidad(0);
            $productoExi->save();
        }
        $productoExi->save();
        $cantidadAnterior = $productoExi->getCantidad();
        $nuevaCantidad = $cantidadAnterior + $cantidad;
        $productoExi->setCantidad($nuevaCantidad);
        $productoExi->save();
    }
    
         static public function Transito($productoId, $cantidad, $bodegaId) {
             $empresaId = sfContext::getInstance()->getUser()->getAttribute("usuario", null, 'empresa');
        $productoExi = ProductoExistenciaQuery::create()
                ->filterByProductoId($productoId)
                ->filterByTiendaId($bodegaId)
                ->findOne();
        if (!$productoExi) {
            $productoExi = new ProductoExistencia();
                     $productoExi->setEmpresaId($empresaId);
            $productoExi->setProductoId($productoId);
            $productoExi->setTiendaId($bodegaId);
            $productoExi->setCantidad(0);
            $productoExi->save();
        }
        $productoExi->save();
        $cantidadAnterior = $productoExi->getTransito();
        $nuevaCantidad = $cantidadAnterior + $cantidad;
        $productoExi->setTransito($nuevaCantidad);
        $productoExi->save();
    }
}
