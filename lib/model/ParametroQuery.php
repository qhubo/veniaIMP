<?php

/**
 * Skeleton subclass for performing query and update operations on the 'parametro' table.
 *
 *
 *
 * This class was autogenerated by Propel 1.6.7 on:
 *
 * 01/11/22 01:11:37
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class ParametroQuery extends BaseParametroQuery {

    static public function ObtenerIva($valor, $excento = false, $retieneISR = true, $excentoIsr = false, $tipo = '', $retieneIVA = false, $ImpuestoGas = 0) {

//        echo $ImpuestoGas;
//        die();
        // RETIENE IVA -> LOS QUE NO TIENE CHECK RETIENE => NO APLICAN IVA  SON EXCENTOS $excento=true
        // EXENTO ISR ->  VALOR_ISR=0 
        // RETIENE ISR ->  los que tiene check VALOR_RETIENE_IVA => con valor 
        $IVA = $valor - (($valor-$ImpuestoGas) / 1.12);
        $IVA=$IVA-$ImpuestoGas;        
        $VALOR_SIN_IVA = ($valor-$ImpuestoGas) / 1.12;
        //$VALOR_SIN_IVA=$VALOR_SIN_IVA-$ImpuestoGas;
        $tipo = trim(strtoupper($tipo));
        $tipo = str_replace(" ", "", $tipo);
        $tipo = trim($tipo);
        $tipo = substr($tipo, 0, 5);

        if ($tipo == "PEQUE") {
            $IVA = 0;
            $VALOR_SIN_IVA = 0;
            if ($valor > "2500.01") {
                $IVA = $valor - ($valor / 1.05);
                $VALOR_SIN_IVA = $valor / 1.05;
            }
        }
        
        $return['VALOR_TOTAL'] = round($valor, 2);
        $return['IVA'] = round($IVA, 2);
        $return['VALOR_SIN_IVA'] = round($VALOR_SIN_IVA, 2);
        $return['VALOR_ISR1'] = $return['IVA'] * 0.15;
        if ($tipo == "PEQUE") {
            $return['VALOR_ISR1'] = $valor * 0.05;
        }
        $return['VALOR_RETIENE_IVA1'] = 0;
        $return['VALOR_RETIENE_IVA1'] = $return['VALOR_SIN_IVA'] * 0.05;
        if ($excento) {
            $return['IVA'] = 0;
            $return['VALOR_SIN_IVA'] = $valor;
        }
        if (!$excentoIsr) {
            $return['VALOR_RETIENE_IVA1'] = 0;
        }
        if (!$retieneISR) {
            $return['VALOR_ISR1'] = 0;
        }
        $return['VALOR_ISR'] = $return['VALOR_RETIENE_IVA1']; // > 339.3315
        $return['VALOR_RETIENE_IVA'] = $return['VALOR_ISR1']; //> 942.5895
        $return['VALOR_SIN_ISR'] = $return['VALOR_TOTAL'] - $return['VALOR_ISR'] - $return['VALOR_RETIENE_IVA'];
        $return['VALOR_RETENIDO_IVA'] = 0;
        if ($retieneIVA) {
            $return['VALOR_RETENIDO_IVA'] = $return['IVA'] * 0.15;
        }

        unset($return['VALOR_ISR1']);
        unset($return['VALOR_RETIENE_IVA1']);

//        echo "<pre>";
//        print_r($return);
//        die();
//        
        RETURN $return;
    }

}
