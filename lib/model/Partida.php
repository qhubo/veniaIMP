<?php

/**
 * Skeleton subclass for representing a row from the 'partida' table.
 *
 *
 *
 * This class was autogenerated by Propel 1.6.7 on:
 *
 * 01/11/22 01:11:38
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class Partida extends BasePartida {

    public function getFechaOperacion() {
        $retorna = "";
        $retorna = $this->getTipo();
        $tipoU = trim(str_replace(" ", "", $this->getTipo()));
        $tipoU = rtrim($tipoU);
        $tipoU = ltrim($tipoU);
        if ($tipoU == "DebitoBanco") {
            //$url="debito_banco/muestra?id=" . $lista->getCodigo(); 
            $movimientoBanco = MovimientoBancoQuery::create()->findOneById($this->getCodigo());
            if ($movimientoBanco) {
                $retorna = $movimientoBanco->getCreatedAt();
            }
        }
        if ($tipoU == "TransferenciaBanco") {
            //      $url="debito_banco/muestra?id=" . $lista->getCodigo(); 
            $movimientoBanco = MovimientoBancoQuery::create()->findOneById($this->getCodigo());
            if ($movimientoBanco) {
                $retorna = $movimientoBanco->getCreatedAt();
            }
        }
        if ($tipoU == "OrdenDevolución") {
//         $url="orden_devolucion/vista?id=" . $lista->getCodigo(); 
            $devolucion = OrdenDevolucionQuery::create()->findOneById($this->getCodigo());
            if ($devolucion) {
                $chqueq = ChequeQuery::create()
                        ->filterByOrdenDevolucionId($devolucion->getId())
                        ->findOne();
                $nume = 0;
                if ($chqueq) {
                    $nume = $chqueq->getNumero();
                }

                $retorna = $devolucion->getCreatedAt();
            }
        }
        if ($tipoU == "VentaResumida") {
            $explode = explode("-", $this->getCodigo());

            $retorna = $this->getFechaContable();
            $medioPa = MedioPagoQuery::create()->findOneByCodigo($explode[0]);
            if ($medioPa) {
                // $retorna = $this->getFechaContable();
            }
        }
        if ($tipoU == "Gasto") {
            $token = sha1($this->getCodigo());


            $ordenQ = GastoQuery::create()->findOneByToken($token);
            if ($ordenQ) {
                $retorna = $ordenQ->getCreatedAt();
            }
        }
        if ($tipoU == "GastoCaja") {

            $ordeCa = GastoCajaQuery::create()->findOneById(trim($this->getCodigo()));
            if ($ordeCa) {
                $retorna = $ordeCa->getCreatedAt();
            }

            //$url="orden_gasto/vista?cajaid=Caja" .$lista->getCodigo(); 
        }
        if ($tipoU == "PagoGasto") {
            $arrayC = explode("GGAP", $this->getCodigo());
            $id = $arrayC[1];
            $ventaRsumida = GastoPagoQuery::create()->findOneById($id);
            if ($ventaRsumida) {
                $retorna = $ventaRsumida->getCreatedAt();
            }


            //       $url="pagos_realizado/vista?id=".$arrayC[1]; 
        }

        return $retorna;
    }

    public function getBanco() {
        $retor = 'SIN MOVIMIENTO BANCO';
        $movimientoBan = MovimientoBancoQuery::create()
                ->findOneByPartidaNo($this->getId());
        if ($movimientoBan) {
            $retor = $movimientoBan->getBancoRelatedByBancoId()->getNombre() . "  " . $movimientoBan->getTipo();
        }
        return $retor;
    }

    public function getCompleto() {
        
//        if ($this->getDetalle() <> "") {
//            return $this->getDetalle();
//        }
        $sqlexp="select detalle from partida where id=". $this->getId();
   
        $con = Propel::getConnection();
        $stmt = $con->prepare($sqlexp);
        $resource = $stmt->execute();
        $result = $stmt->fetchAll(PDO::FETCH_ASSOC);
        $detalle = $result[0]["detalle"];
        if (($detalle <> "")) {
            return $detalle;
        }
        
        $retorna = $this->getTipo();
        $tipoU = trim(str_replace(" ", "", $this->getTipo()));
        $tipoU = rtrim($tipoU);
        $tipoU = ltrim($tipoU);
        if ($tipoU == "DebitoBanco") {
            //$url="debito_banco/muestra?id=" . $lista->getCodigo(); 
            $movimientoBanco = MovimientoBancoQuery::create()->findOneById($this->getCodigo());
            if ($movimientoBanco) {
                $retorna = "Debito Banco " . $movimientoBanco->getObservaciones() . "  " . $movimientoBanco->getTipoMovimiento() . "  Valor " . $movimientoBanco->getValor();
            }
        }
        if ($tipoU == "Gasto") {
            $token = sha1($this->getCodigo());
            $ordenQ = GastoQuery::create()->findOneByToken($token);
            if ($ordenQ) {
                $retorna = "  Gasto Proveedor " . $ordenQ->getProveedor() . " Valor Q " . $ordenQ->getValorTotal();
            }
        }
        if ($tipoU == "NotaCliente") {
            $notaCredito = NotaCreditoQuery::create()->findOneByCodigo($this->getCodigo());
            if ($notaCredito) {
                $retorna = 'Nota Credito ' . $this->getCodigo() . " " . $notaCredito->getNombre() . " " . $notaCredito->getConcepto() . " Valor " . $notaCredito->getValorTotal();
            }
        }
        if ($tipoU == "TransferenciaBanco") {
            //      $url="debito_banco/muestra?id=" . $lista->getCodigo(); 
            $movimientoBanco = MovimientoBancoQuery::create()->findOneById($this->getCodigo());
            if ($movimientoBanco) {
                $retorna = "Transferencia Banco " . $movimientoBanco->getObservaciones() . "  " . $movimientoBanco->getTipoMovimiento() . " Valor " . $movimientoBanco->getValor();
            }
        }
        if ($tipoU == "OrdenCompra") {
            $ordenPro = OrdenProveedorQuery::create()->findOneByCodigo($this->getCodigo());
            if ($ordenPro) {
                $retorna= "Orden Compra ".$ordenPro->getCodigo()." ".$ordenPro->getNombre()." ".$ordenPro->getComentario()." Valor ".$ordenPro->getValorTotal();
            }
        }
        if ($tipoU == "OrdenDevolución") {
//         $url="orden_devolucion/vista?id=" . $lista->getCodigo(); 
            $devolucion = OrdenDevolucionQuery::create()->findOneById($this->getCodigo());
            if ($devolucion) {
                $chqueq = ChequeQuery::create()
                        ->filterByOrdenDevolucionId($devolucion->getId())
                        ->findOne();
                $nume = 0;
                if ($chqueq) {
                    $nume = $chqueq->getNumero();
                }
                $retorna = "Devolucion " . $devolucion->getCodigo() . " " . $devolucion->getNombre() . " " . $devolucion->getPagoMedio() . " " . $nume . " Valor Q" . $devolucion->getValor();
            }
        }
        if ($tipoU == "PagoGasto") {
            $arrayC = explode("GGAP", $this->getCodigo());
            $id = $arrayC[1];
            $ventaRsumida = GastoPagoQuery::create()->findOneById($id);
            if ($ventaRsumida) {
                $retorna = "  Pago Proveedor " . $ventaRsumida->getTipoPago() . "   " . $ventaRsumida->getDocumento() . " Valor  Q" . $ventaRsumida->getValorTotal();
                if ($this->getDetalle()) {
                    $retorna = "  Gasto Proveedor  " . $ventaRsumida->getTipoPago() . "  " . $this->getDetalle();
                }
            }
        }
        if ($tipoU == "PagoProveedor") {
            $ordenPagoPro = OrdenProveedorPagoQuery::create()->findOneByCodigo($this->getCodigo());
            if ($ordenPagoPro) {
             $retorna = "  Pago Proveedor " . $ordenPagoPro->getTipoPago() . " Doc   " .$ordenPagoPro->getDocumento() . " Valor  Q" . $ordenPagoPro->getValorTotal();
            }
               $ordenPagoPro = GastoPagoQuery::create()->findOneByCodigo($this->getCodigo());
            if ($ordenPagoPro) {
                $retorna = "  Pago Proveedor " . $ordenPagoPro->getTipoPago() . "   " . $ordenPagoPro->getDocumento() . " Valor  Q" . $ordenPagoPro->getValorTotal();
               
            }
            
        }
        if ($tipoU == "PagoVentaCobrar") {
            $operaiconPago = OperacionPagoQuery::create()->findOneById($this->getCodigo());
            if ($operaiconPago) {
                $retorna = "Recibo ".$operaiconPago->getCodigo()." ".$operaiconPago->getTipo()." ".$operaiconPago->getDocumento()."  Valor Q ".$operaiconPago->getValor();
            }
            
        }
        if ($tipoU == "Venta") {
         $opreacion = OperacionQuery::create()->findOneByCodigo($this->getCodigo());
         if ($opreacion) {
             $retorna = "Factura ".$opreacion->getCodigo()." ".$opreacion->getNombre()." Valor Q".$opreacion->getValorTotal();
         }
            
        }
        if ($tipoU == "VentaResumida") {
            $explode = explode("-", $this->getCodigo());
            $medioPa = MedioPagoQuery::create()->findOneByCodigo($explode[0]);
            if ($medioPa) {
                $retorna = "Venta  " . $this->getTienda() . " " . $this->getMedioPago();
            }
        }

        if ($tipoU == "GastoCaja") {
            $ordeCa = GastoCajaQuery::create()->findOneById(trim($this->getCodigo()));
            if ($ordeCa) {
                $retorna = "  Gasto Caja " . $ordeCa->getConcepto() . " Valor Q " . round($ordeCa->getValorTotal(), 2);
            }
            //$url="orden_gasto/vista?cajaid=Caja" .$lista->getCodigo(); 
        }

        return $retorna;
    }

//    
    public function getVenta() {
        $retorna = '';
        $ventaResumen = VentaResumidaQuery::create()->findOneByPartidaNo($this->getId());
        if ($ventaResumen) {
            $retorna = $ventaResumen->getObservaciones();
            $ventaLi = VentaResumidaLineaQuery::create()->findOneByVentaResumidaId($ventaResumen->getId());
            if ($ventaLi) {
                if ($ventaLi->getBancoId()) {
                    $retorna .= " " . $ventaLi->getBanco()->getNombre();
                }
            }
        }
        return $retorna;
    }

    static public function Pendientes() {
        $tiendas[] = 26; //  Barberena    
        $tiendas[] = 27; // centro servicio;
        $tiendas[] = 23; // chimaltenango
        $tiendas[] = 19; // escuintla
        $tiendas[] = 24; // chiquimula
        $tiendas[] = 28; // huehuetenango
        $tiendas[] = 21; // petapa
        $tiendas[] = 25; // villa nueva
        $tiendas[] = 20; // san juan
        $tiendas[] = 29; // teculutan
        $tiendas[] = 16;
        $tiendas[] = 17; // teculutan
        $partidaQ = PartidaQuery::create()
                ->filterByConfirmada(false)
                ->filterByTiendaId($tiendas, Criteria::IN)
                ->find();
        $can = 0;
        foreach ($partidaQ as $lin) {
            $pendientes = PartidaDetalleQuery::create()
                    ->filterByPartidaId($lin->getId())
                    ->filterByCuentaContable(null)
                    ->count();
            $pendientes1 = PartidaDetalleQuery::create()
                    ->filterByPartidaId($lin->getId())
                    ->filterByCuentaContable('')
                    ->count();

            $totalPendientes = $pendientes + $pendientes1;
            if ($totalPendientes == 0) {
                $can++;
                $lin->setConfirmada(true);
                $lin->save();
            }
        }
        return $can;
    }

    static public function pobladatosPartida($id, $empresaId = null) {
        $datos = null;
        $usuarioId = sfContext::getInstance()->getUser()->getAttribute('usuario', null, 'seguridad');
        $usuarioQue = UsuarioQuery::create()->findOneById($usuarioId);
        $empresaId = $usuarioQue->getEmpresaId();
        $lineaInicial = 1;
        header('Content-type: text/plain; charset=utf-8');
        $bitacora = BitacoraArchivoQuery::create()->findOneById($id);
        sfContext::getInstance()->getUser()->setAttribute('muestrabusqueda', 0, 'busqueda');
        $filename = $bitacora->getNombre();
        $inputFileName = sfConfig::get("sf_upload_dir") . DIRECTORY_SEPARATOR . 'cargas' . DIRECTORY_SEPARATOR . $filename;
        $objReader = new PHPExcel_Reader_Excel5();
        $objPHPExcel = $objReader->load($inputFileName);
        $sheetData = $objPHPExcel->getActiveSheet()->toArray(null, true, true, true);
        $contador = 0;
        $colasiento = null;
        $colcuenta = null;
        $colnombre = null;
        $coldebito = null;
        $colcredito = null;
        $coldetalle = null;
        $listaId = null;
        $NUMERO = 0;
        $listaNO[] = "000";
//        echo "<pre>";
//        print_r($sheetData);
//        echo "</pre>";
//        die();
//              $listaNO=null;
        foreach ($sheetData as $registro) {
            $lista = null;

            $ASIENTO = null;
            $CUENTA = null;
            $NOMBRE = null;
            $DETALLE = null;
            $DEBE = null;
            $CREDITO = null;
            $valido = true;
            $contador++;
            $textoPendiente = '';
            $pendientes = null;
            $lin = $lineaInicial;
            /// encabezado
            //   echo PlantillaCampoQuery::campo($empresaId, 'codigo_sku');
            if ($contador == 1) {
                //    echo "<pre>";
//              print_r($registro);
//              die();
                for ($i = 0; $i <= 6; $i++) {
                    $letra = CorrelativoCodigoQuery::numeroletra($i); //sfContext::getInstance()->getUser()->numeroletra($i);
                    $campo = trim(strtoupper(($registro[$letra])));
                    $campo = ($campo);
//                    $campo = ProveedorPeer::limpiatil($campo);
                    $campo = trim(strtoupper($campo));
                    $campo = str_replace(" ", "", $campo); //                  
//                         echo $campo;
//                        echo " ------------- ";
                    switch ($campo) {
                        case 'ASIENTO':
                            $colasiento = $letra;
                            break;
                        case 'CUENTA':
                            $colcuenta = $letra;
                            break;
                        case 'NOMBRE':
                            $colnombre = $letra;
                            break;
                        case 'DEBITO':
                            $coldebito = $letra;
                            break;
                        case 'DETALLE':
                            $coldetalle = $letra;
                            break;
                        case 'CREDITO':
                            $colcredito = $letra;
                            break;
                    }
                }
                //     die();
            }

            $mensaje = '';

// asiento	cuenta	nombre	debito	credito	detalle

            if ($contador > $lineaInicial) {
                $NUMERO++;
                $CuentaID = null;
                if (array_key_exists($colasiento, $registro)) {
                    $ASIENTO = trim($registro[$colasiento]);
                } else {
                    $valido = false;
                    $pendientes[] = 'ASIENTO';
                }

                if (array_key_exists($colcuenta, $registro)) {
                    $CUENTA = trim(($registro[$colcuenta]));
                } else {
                    $valido = false;
                    $pendientes[] = 'CUENTA';
                }

                if (array_key_exists($colnombre, $registro)) {
                    $NOMBRE = trim($registro[$colnombre]);
                } else {
                    $valido = false;
                    $pendientes[] = 'NOMBRE';
                }
                if (array_key_exists($coldebito, $registro)) {
                    $DEBE = trim(($registro[$coldebito]));
                } else {
                    $valido = false;
                    $pendientes[] = 'DEBITO';
                }

                if (array_key_exists($colcredito, $registro)) {
                    $HABER = trim(($registro[$colcredito]));
                } else {
                    $valido = false;
                    $pendientes[] = 'CREDITO';
                }


                if ($valido == true) {

                    $validolI = TRUE;
                    $mensaje = " ";
                    $cuentaErp = CuentaErpContableQuery::create()->findOneByCuentaContable($CUENTA);

                    // 1110-08
                    if ($CUENTA == '1110-08') {
                        $validolI = false;
                    }
                    //        echo $CUENTA."<br>";
                    $lista['LINEA'] = $contador;
                    $DEBE = str_replace(",", "", $DEBE);
                    $HABER = str_replace(",", "", $HABER);
                    $saldo = $DEBE + $HABER;
                    if ($saldo > 0) {
                        //       asiento	cuenta	nombre	debito	credito	detalle
                        $listaId[$ASIENTO] = $ASIENTO;
                        $lista['ASIENTO'] = $ASIENTO;
                        $lista['CUENTA'] = $CUENTA;
                        $lista['NOMBRE'] = $NOMBRE;
                        $lista['ID'] = null;
                        if ($cuentaErp) {
                            $lista['ID'] = $cuentaErp->getId();
                        }
                        $lista['DEBITO'] = $DEBE;
                        $lista['CREDITO'] = $HABER;
                        $lista['MENSAJE'] = $mensaje;
                        $lista['VALIDO'] = $validolI;
                        $datos[$ASIENTO][] = $lista;
                        if (!$validolI) {

                            $listaNO[$ASIENTO] = $ASIENTO;
                        }
                    }
                }
            }
        }
        $resultado['listaNO'] = $listaNO;
        $resultado['lista'] = $listaId;
        $resultado['datos'] = $datos;
        $resultado['valido'] = $valido;
        $resultado['pendiente'] = $pendientes;
//echo "<pre>";
//print_r($resultado);
//die();

        return $resultado;
    }

    public function getNoCodigo() {
        $numero = $this->getNumero();
        $ano = $this->getFechaContable('Y');
        $completo = $numero;
        if (strlen($numero) == 1) {
            $completo = "000" . $numero;
        }
        if (strlen($numero) == 2) {
            $completo = "00" . $numero;
        }
        if (strlen($numero) == 3) {
            $completo = "00" . $numero;
        }
        $retorna = $ano . $completo;
        if (!$this->getNumero()) {
            $retorna = $this->getCodigo();
        }
        return $retorna;
    }

    public function getNoAsiento() {
        $numero = $this->getId();
        $ano = $this->getFechaContable('Y');
        $completo = $numero;
        if (strlen($numero) == 1) {
            $completo = "000" . $numero;
        }
        if (strlen($numero) == 2) {
            $completo = "00" . $numero;
        }
        if (strlen($numero) == 3) {
            $completo = "00" . $numero;
        }
        $retorna = $ano . $completo;
        if ($this->getNumero()) {
            $retorna = $this->getNumero();
        }
        return $retorna;
    }

    public function getListDetalle() {
        $detalle = PartidaDetalleQuery::create()
                ->filterByPartidaId($this->getId())
                ->find();
        $lis[] = 0;
        foreach ($detalle as $reg) {
            $lis[] = $reg->getId();
        }
        return $lis;
    }

    static public function busca($grupo, $tipo = 0, $debe = 1, $limpia = '', $tienda = '') {
        $tienda = trim($tienda);
        $empresaId = sfContext::getInstance()->getUser()->getAttribute("usuario", null, 'empresa');
        $returna['cuenta'] = '';
        $returna['nombre'] = '';
        $busca = true;
        $definicionCuenta = DefinicionCuentaQuery::create()
                ->filterByTipo($tipo)
                ->filterByGrupo($grupo)
                ->findOne();
        if ($tienda <> '') {
            $definicionCuenta = DefinicionCuentaQuery::create()
                    ->filterByGrupo($grupo)
                    ->filterByDetalle($tienda)
                    ->findOne();
        }

        if ($definicionCuenta) {
            $cuenta = $definicionCuenta->getCuentaContable();
            $nombreCuenta = Partida::cuenta($cuenta);
            $busca = false;
            $returna['cuenta'] = $cuenta;
            $returna['nombre'] = $nombreCuenta;
        }
        if (!$definicionCuenta) {
            if ($tipo == 1) {
                $tipoProducto = TipoAparatoQuery::create()->findOneByCodigo($grupo);
                if ($tipoProducto) {
                    $cuenta = $tipoProducto->getCuentaContable();
                    $nombreCuenta = Partida::cuenta($cuenta);
                    $busca = false;
                    $returna['cuenta'] = $cuenta;
                    $returna['nombre'] = $nombreCuenta;
                }
            }
            if ($tipo == 2) {
                $tipoProducto = MedioPagoQuery::create()->findOneByCodigo($grupo);
                if ($tipoProducto) {
                    $cuenta = $tipoProducto->getCuentaContable();
                    $nombreCuenta = Partida::cuenta($cuenta);
                    $busca = false;
                    $returna['cuenta'] = $cuenta;
                    $returna['nombre'] = $nombreCuenta;
                }
            }
            if ($tipo == 3) {
                $tipoProducto = MedioPagoQuery::create()->findOneByNombre($grupo);
                if ($tipoProducto) {
                    $cuenta = trim($tipoProducto->getCuentaContable());
                    $nombreCuenta = Partida::cuenta($cuenta);
                    $busca = false;
                    $returna['cuenta'] = $cuenta;
                    $returna['nombre'] = $nombreCuenta;
                }
            }
            if ($tipo == 4) {
                $tipoProducto = TiendaQuery::create()->findOneByNombre($tienda);

                if ($tipoProducto) {
                    $cuenta = trim($tipoProducto->getCuentaHaber());

                    $nombreCuenta = Partida::cuenta($cuenta);

                    $busca = false;
                    $returna['cuenta'] = $cuenta;
                    $returna['nombre'] = $nombreCuenta;
                }
            }

            if ($busca) {
                $grupo = str_replace($limpia, "", $grupo);
                $grupo = trim($grupo);
                $sqlexp = " SELECT cuenta_contable,nombre  from  cuenta_erp_contable  where  nombre  "
                        . " like '%" . $grupo . "%'  and  cuenta_contable not like  '%00'  and empresa_id = " . $empresaId;

                $con = Propel::getConnection();
                $stmt = $con->prepare($sqlexp);
                $resource = $stmt->execute();
                $result = $stmt->fetchAll(PDO::FETCH_ASSOC);
                if ($result) {
                    $cuenta = $result[0]["cuenta_contable"];
                    $nombreCuenta = $result[0]["nombre"];
                }

                $returna['cuenta'] = $cuenta;
                $returna['nombre'] = $nombreCuenta;
            }
        }
        return $returna;
    }

    static public function Crea($tipo, $codigo, $valor, $tiendaId = null, $fecha = null) {
        date_default_timezone_set("America/Guatemala");
        $usuario = sfContext::getInstance()->getUser()->getAttribute('usuarioNombre', null, 'seguridad');
        $partidaQ = PartidaQuery::create()->findOneByCodigo($codigo);
        if ($partidaQ) {
            $detalle = PartidaDetalleQuery::create()
                    ->filterByPartidaId($partidaQ->getId())
                    ->find();
            if ($detalle) {
                $detalle->delete();
            }
        }
        if (!$partidaQ) {
            $partidaQ = new Partida();
        }
        $partidaQ->setFechaContable(date('Y-m-d'));
        if ($fecha) {
            $partidaQ->setFechaContable($fecha);
        }
        $partidaQ->setUsuario($usuario);
        $partidaQ->setTipo($tipo);
        $partidaQ->setCodigo($codigo);
        $partidaQ->setValor($valor);
        if ($tiendaId) {
            $partidaQ->setTiendaId($tiendaId);
        }
        $partidaQ->save();
        return $partidaQ->getId();
    }

    static public function cuenta($cuenta) {
        $query = CuentaErpContableQuery::create()->findOneByCuentaContable($cuenta);
        $nombre = $cuenta;
        if ($query) {
            $nombre = $query->getNombre();
        }
        return $nombre;
    }

    public function save(PropelPDO $con = null) {
        $empresaId = UsuarioQuery::getEmpresaSeleccionada('Partida');
        if ($this->isNew()) {
            if ($empresaId) {
                $this->setEmpresaId($empresaId);
            }
        }
        if ($this->getCodigo() == "") {
            if ($this->getConfirmada()) {
                if (!$this->getNumero()) {
                    date_default_timezone_set("America/Guatemala");
                    $empresaId = $this->getEmpresaId();
                    $tipo = $empresaId . 'P' . date("Y");
                    $pre = $empresaId . 'P' . date("Y");
                    $numero = 1;
                    $busca = CorrelativoCodigoQuery::create()
                            ->filterByTipo($tipo)
                            ->findOne();
                    if (!$busca) {
                        $busca = New CorrelativoCodigo();
                        $busca->setTipo($tipo);
                        $busca->setPrefijo($pre);
                        $busca->setNumeroAsginar($numero);
                        $busca->save();
                    }
                    $numero = $busca->getNumeroAsginar();
                    $prefijo = $pre . $numero;
                    if (strlen($numero) == 1) {
                        $prefijo = $pre . '0' . $numero;
                    }
                    if ($numero > 99) {
                        $prefijo = $pre . $numero;
                    }
                    $this->setNumero($numero);

                    $busca->setNumeroAsginar($numero + 1);
                    $busca->save();
                }
            }
        }

        // if ($this->getMes() == '') {
        $this->setMes((int) $this->getFechaContable('m'));
        $this->setAno((int) $this->getFechaContable('Y'));
        //   }

        parent::save($con);
    }

}
