<?php

/**
 * Skeleton subclass for performing query and update operations on the 'usuario' table.
 *
 *
 *
 * This class was autogenerated by Propel 1.6.7 on:
 *
 * Fri Sep 20 13:26:47 2013
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class UsuarioQuery extends BaseUsuarioQuery {

    static public function validaUsuario($u, $c) {

        $intentos = 10; // sfConfig::get("app_seguridad_intentos",3);
        $segundos_bloqueo = 10; // sfConfig::get("app_seguridad_tiempo",60);
        $hora_bloqueo = date('Y-m-d H:i:s', mktime(date('H'), date('i'), date('s') + $segundos_bloqueo, date('m'), date('d'), date('Y')));
        $usuario = UsuarioQuery::create()
                ->filterByUsuario($u)
                ->findOne();

        $msg = null;
        if ($usuario) {
            if ($usuario->getClave() == $c) {
                
            } else {
                $msg = 'Usuario/Clave Inválido';
                $usuario = null;
            }
        } else {
            $usuario = null;
            $msg = 'Usuario/Clave Inválido';
        }
        sfContext::getInstance()->getUser()->setFlash('login', $msg);
        return $usuario;
    }

    static function menuUsuario($usuario_id) {

    }
  static function getEmpresaSeleccionada($tabla = null) {
        $retorno = false;
        if (sfContext::hasInstance()) {
            $user = sfContext::getInstance()->getUser();
            if ($user->isAuthenticated()) {
                if ($user->getAttribute('filtro', null, $tabla) || is_null($user->getAttribute('filtro', null, $tabla))) {
                    $empresaSeleccion = $user->getAttribute('usuario', null, 'empresa');
                    if ($empresaSeleccion) {
                        $retorno = $empresaSeleccion;
                    }
                } else {
                    $user->setAttribute('filtro', true, $tabla);
                }
            }
        }
        $retorno =    sfContext::getInstance()->getUser()->getAttribute("empresa", null, 'seguridad');
 
        return $retorno;
    }

    static function getUsuario($tabla = null) {
        $retorno = false;
        if (sfContext::hasInstance()) {
            $user = sfContext::getInstance()->getUser();
            if ($user->isAuthenticated()) {
                $usuarioSeleccionado = $user->getAttribute('usuario', null, 'seguridad');
                if ($usuarioSeleccionado) {
                    $retorno = $usuarioSeleccionado;
                }
            }
        }
        return $retorno;
    }

     static public  function numeroletra($numero) {
        switch ($numero) {
            case 0: $letra = "A";
                break;
            case 1: $letra = "B";
                break;
            case 2: $letra = "C";
                break;
            case 3: $letra = "D";
                break;
            case 4: $letra = "E";
                break;
            case 5: $letra = "F";
                break;
            case 6: $letra = "G";
                break;
            case 7: $letra = "H";
                break;
            case 8: $letra = "I";
                break;
            case 9: $letra = "J";
                break;
            case 10: $letra = "K";
                break;
            case 11: $letra = "L";
                break;
            case 12: $letra = "M";
                break;
            case 13: $letra = "N";
                break;
            case 14: $letra = "O";
                break;
            case 15: $letra = "P";
                break;
            case 16: $letra = "Q";
                break;
            case 17: $letra = "R";
                break;
            case 18: $letra = "S";
                break;
            case 19: $letra = "T";
                break;
            case 20: $letra = "U";
                break;
            case 21: $letra = "V";
                break;
            case 22: $letra = "W";
                break;
            case 23: $letra = "X";
                break;
            case 24: $letra = "Y";
                break;
            case 25: $letra = "Z";
                break;
            case 26: $letra = "AA";
                break;
            case 27: $letra = "AB";
                break;
            case 28: $letra = "AC";
                break;
            case 29: $letra = "AD";
                break;
            case 30: $letra = "AE";
                break;
            case 31: $letra = "AF";
                break;
            case 32: $letra = "AG";
                break;
            case 33: $letra = "AH";
                break;
            case 34: $letra = "AI";
                break;
            case 35: $letra = "AJ";
                break;
            case 36: $letra = "AK";
                break;
            case 37: $letra = "AL";
                break;
            case 38: $letra = "AM";
                break;
            case 39: $letra = "AN";
                break;
            case 40: $letra = "AO";
                break;
            case 41: $letra = "AP";
                break;
            case 42: $letra = "AQ";
                break;
            case 43: $letra = "AR";
                break;
            case 44: $letra = "AS";
                break;
            case 45: $letra = "AT";
                break;
            case 46: $letra = "AU";
                break;
            case 47: $letra = "AV";
                break;
            case 48: $letra = "AW";
                break;
            case 49: $letra = "AY";
                break;
            case 50: $letra = "AZ";
                break;
        }
        return $letra;
    }
}
