<?php

/**
 * Skeleton subclass for representing a row from the 'lista_activos' table.
 *
 *
 *
 * This class was autogenerated by Propel 1.6.7 on:
 *
 * 05/11/23 17:33:36
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class ListaActivos extends BaseListaActivos {

    public function save(PropelPDO $con = null) {
        $empresaId = UsuarioQuery::getEmpresaSeleccionada('ListaActivos');

        if ($this->isNew()) {
            if ($empresaId) {
                $this->setEmpresaId($empresaId);
            }
            parent::save($con);
        }
    }

    public function getFechaFinal() {
        $ano = $this->getFechaAdquision("Y") + $this->getAnioUtil();
        $DiaMes = $this->getFechaAdquision('d/m/');

        $retorna = $DiaMes . $ano;

        return $retorna;
    }

    public function getMesesUso($fechaActual=null) {
        if (!$fechaActual) {
            $fechaActual=date('Y-m-d');
        }
        $fechaInicio = new DateTime($this->getFechaAdquision('Y-m-d'));
        $fechaFin = new DateTime($fechaActual);
        $intervalo = $fechaInicio->diff($fechaFin);
        $cantidadAnio = $intervalo->y;
        $cantidadMes = $intervalo->m;
        $cantidaTotalMEses = ($cantidadAnio * 12) + $cantidadMes;

        return $cantidaTotalMEses;
    }

    public function getAnioUso($fechaActual=null) {
        $fechaInicio = new DateTime($this->getFechaAdquision('Y-m-d'));
                if (!$fechaActual) {
            $fechaActual=date('Y-m-d');
        }
        $fechaFin = new DateTime($fechaActual);
        $intervalo = $fechaInicio->diff($fechaFin);
        $cantidadAnio = $intervalo->y;

        $cantidaTotalMEses = ($cantidadAnio);

        return $cantidaTotalMEses;
    }

    public function getNoMeses() {
        $retorna = $this->getAnioUtil() * 12;
        return $retorna;
    }

    public function getDepreAnual() {
        $valorLibros = $this->getValorLibro();
        $por = $this->getPorcentaje();
        $retorna = ($valorLibros * $por) / 100;
      //  $retorna =$valorLibros/$this->getAnioUtil();
        return $retorna;
    }

    public function getDepreMensual($fechaActual=null) {
       
                   if (!$fechaActual) {
            $fechaActual=date('d-m-Y');
        }
//       $valorLibros = $this->getValorLibro();
//        $por = $this->getPorcentaje();
//        $retorna = ($valorLibros * $por) / 100;
//        $retorna = $retorna / 12;
        $valoresActual = explode("-", $fechaActual);
        $mesAnoVence= 303030; 
        if ($this->getFechaFinal()) {
           $valoresvence= explode("/", $this->getFechaFinal());
          $mesAnoVence= $valoresvence[2].$valoresvence[1];
        }
        $mesAnoActual= $valoresActual[2].$valoresActual[1];
     
        
        $dias=30;
        if ($mesAnoVence ==$mesAnoActual) {
            $dias= $valoresvence[0];
            }
        
        $valor = $this->getDepreAnual()/365;
        $retorna=$valor*$dias;
        $retorna=round($retorna,2);
        return $retorna;
    }

    public function getVencido() {
        $vencido = false;
        $ano = $this->getFechaAdquision("Y") + $this->getAnioUtil();
        $MesDia = $this->getFechaAdquision('md');
        $fechaVence = $ano . $MesDia;
        $fechaActual = date('Ymd');
        if ($fechaVence < $fechaActual) {
            $vencido = true;
        }
        return $vencido;
    }

    
    public function getDepreAcumulada ($fechaActual=null) {
        $mensual = $this->getDepreMensual();
        $meses = $this->getMesesUso($fechaActual);
        

        $totalDepreciacion = $mensual*$meses;        
        if ($this->getValorLibro() < $totalDepreciacion) {
            $totalDepreciacion= $this->getValorLibro();
        }
       
        return $totalDepreciacion;
    }
      public function getDepreAcumuladaMesAnterior ($fechaActual=null) {
        $mensual = $this->getDepreMensual();
        $meses = $this->getMesesUso($fechaActual)-1;
        
        $totalDepreciacion = $mensual*$meses;        
        if ($this->getValorLibro() < $totalDepreciacion) {
            $totalDepreciacion= $this->getValorLibro();
        }
        return $totalDepreciacion;
        
    }
    
    
}
