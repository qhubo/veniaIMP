<?php



/**
 * Skeleton subclass for performing query and update operations on the 'usuario_report' table.
 *
 *
 *
 * This class was autogenerated by Propel 1.6.7 on:
 *
 * 10/12/23 06:27:39
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class UsuarioReportQuery extends BaseUsuarioReportQuery
{
        static public function lecturaPDF($rutaxml) {
        // $rutaxml = "uploads/7DEE96E8-8DF0-49D9-943F-C4B48C0E6661.xml";
        $fichero = file_get_contents($rutaxml, true);
        $fichero = str_replace("ds:", "", $fichero);
        $fichero = str_replace("dte:", "", $fichero);
        $xmlget = simplexml_load_string($fichero);

     
//        echo "<pre>";
//        print_r($datos);
//        die();
        $datos = null;
        foreach ($xmlget->SAT->DTE->DatosEmision->DatosGenerales->attributes() as $key => $valor) {
            $datos['GENERALES'][$key] = (string) $valor;
        }
        foreach ($xmlget->SAT->DTE->DatosEmision->Emisor->attributes() as $key => $valor) {
            $datos['EMISOR'][$key] = (string) $valor;
        }
        $datos['EMISOR']['DireccionEmisor']['Direccion'] = (ARRAY) $xmlget->SAT->DTE->DatosEmision->Emisor->DireccionEmisor;
        foreach ($xmlget->SAT->DTE->DatosEmision->Receptor->attributes() as $key => $valor) {
            $datos['RECEPTOR'][$key] = (string) $valor;
        }
        foreach ($xmlget->SAT->DTE->Certificacion->NumeroAutorizacion->attributes() as $key => $valor) {
            $datos['CertificacionF'][$key] = (string) $valor;
        }
        $datos['Certificacion'] = (ARRAY) $xmlget->SAT->DTE->Certificacion;
        $items = $xmlget->SAT->DTE->DatosEmision->Items->Item;
        $dataPro = null;
        foreach ($items as $item) {
            $item = (array) $item;
            $dataPro['BienOServicio'] = $item['@attributes']['BienOServicio'];
            $dataPro['NumeroLinea'] = $item['@attributes']['NumeroLinea'];
            $dataPro['Cantidad'] = $item['Cantidad']; // 5
            $dataPro['Descripcion'] = $item['Descripcion']; // horas de soporte para re-publicaciÃ³n del proyecto en servidor de desarrollo.  TC.7.83567
            $dataPro['PrecioUnitario'] = $item['PrecioUnitario']; // 35
            $dataPro['Precio'] = $item['Precio']; // 175.000000
            $dataPro['Descuento'] = $item['Descuento']; // 0
            // $dataPro['OtrosDescuento'] = $item['OtrosDescuento']; // 0
            $datos['lineas'][] = $dataPro;
        }

        $fechaHora = explode("T", $datos['GENERALES']['FechaHoraEmision']);
        $fecha = $fechaHora[0];
        $fecha = explode("-", $fecha);
        $fecha = $fecha[2] . "/" . $fecha[1] . "/" . $fecha[0];
        $hora = $fechaHora[1];
        $hora = substr($hora, 0, 8);

        if ($datos['GENERALES']['CodigoMoneda'] == 'GTQ') {
            $datos['GENERALES']['CodigoMoneda'] = " Quetzales ";
        }
        if ($datos['GENERALES']['CodigoMoneda'] == 'USD') {
            $datos['GENERALES']['CodigoMoneda'] = " Dolares ";
        }

        $datos['GENERALES']['FechaHoraEmision'] = $fecha . " " . $hora;
   foreach ($xmlget->SAT->DTE->DatosEmision->Frases[0]->Frase->attributes() as $key => $valor) {
            $datos['GENERALES'][$key] = (string) $valor;
        }
        return $datos;
    }
}
